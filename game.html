<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Tic Tac Toe Multiplayer</title>
        <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
        <link rel="stylesheet" href="css/game.css">
        <link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css'>
    </head>
    <body>
        <div id="app">

            <section>
                <div class="row">
                    <div class="col s12 center">
                        <h4 class="light">Tic Tac Toe Multiplayer</h4>
                    </div>
                    <div class="col s12 center">
                        <p>Yor are plaing as <b><span v-text="username" class="green-text"></span></b> against <b><span v-text="opponent" class="red-text"></span></b></p>
                    </div>
                </div>
            </section>

            <section id="board">
                <div class="container">
                    <div class="row">
                        <div class="col s12">
                            <table>
                                <tr>
                                    <td :class="c[0]" @click="move(0)"></td>
                                    <td :class="c[1]" @click="move(1)"></td>
                                    <td :class="c[2]" @click="move(2)"></td>
                                </tr>
                                <tr>
                                    <td :class="c[3]" @click="move(3)"></td>
                                    <td :class="c[4]" @click="move(4)"></td>
                                    <td :class="c[5]" @click="move(5)"></td>
                                </tr>
                                <tr>
                                    <td :class="c[6]" @click="move(6)"></td>
                                    <td :class="c[7]" @click="move(7)"></td>
                                    <td :class="c[8]" @click="move(8)"></td>
                                </tr>
                            </table>
                        </div>
                        <div class="col s12 center">
                            <h5 v-if="username==turn">Your turn</h5>
                            <h5 v-else><span v-text="opponent"></span>'s turn</h5>
                        </div>
                    </div>
                </div>
            </section>

        </div>

        <script type="text/javascript" src="js/materialize.min.js"></script>
        <script type="text/javascript" src="js/axios.min.js"></script>
        <script src="js/vue.js"></script>
        <script>
            new Vue({

                el: '#app',
                data: {

                    c:[
                        '',
                        '',
                        '',
                        '',
                        '',
                        '',
                        '',
                        '',
                        ''
                    ],

                    username: '',
                    opponent: '',

                    sid: '',
                    myType: '',

                    state: '',
                    turn:'',


                },

                methods: {

                    move: function(n){

                        if(this.c[n] != '' || this.turn != this.username){
                            return;
                        }else{

                            if(this.myType == 'x'){

                                Vue.set(this.c, n, 'x');
                            }else{
                                Vue.set(this.c, n, 'o');
                            }

                            axios.get('./api/game.php?action=move&move='+n+'&type='+this.myType)
                        }
                        
                    },

                    updateBoard: function(){

                        for(var i=0; i<9; i++){

                            if(this.state[i] == 'x'){
                                this.c[i] = 'x';
                            }else if(this.state[i] == 'o'){
                                this.c[i] = 'o';
                            }else{
                                continue;
                            }

                        }
                    }
                },

                created: function(){

                    var self = this;
                    var game;

                    axios.get('./api/game.php?action=gameInfo')
                        .then(function(response){

                            game = response.data;

                            self.username = game.username;
                            self.sid = game.id;
                            self.turn = game.turn;

                            if(game.username == game.creator){
                                self.opponent = game.joiner;
                                self.myType = 'x';
                            }else{
                                self.opponent = game.creator;
                                self.myType = 'o';
                            }

                            self.state = game.state;

                            self.updateBoard();

                        })
                }  

            });
        </script>
    </body>
</html>